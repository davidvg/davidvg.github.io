<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog personal - barra - cajón desastre">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Muerte por Checklist</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="es" href="rss.xml">
<link rel="canonical" href="https://davidvg.github.io/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/ngc7331-y-quinteto-de-stephan/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Mostrar navegación</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://davidvg.github.io/">

                <span id="blog-title">Muerte por Checklist</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="pages/wiki/index.html">Wiki</a>
                </li>
<li>
<a href="archive.html">Archivo</a>
                </li>
<li>
<a href="categories/">Etiquetas</a>
                </li>
<li>
<a href="rss.xml">Canal RSS</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ngc7331-y-quinteto-de-stephan/" class="u-url">NGC7331 y el Quinteto de Stephan</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/ngc7331-y-quinteto-de-stephan/" rel="bookmark">
            <time class="published dt-published" datetime="2019-08-11T12:00:00+02:00" itemprop="datePublished" title="2019-08-11">2019-08-11</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Siguiendo con las pruebas de la <strong>Cámara nueva</strong>, esta vez con unas cuantas galaxias.</p>
<div class="line-block">
<div class="line"><br></div>
</div>
<img alt="NGC7331 y el Quinteto de Stephan" class="align-center" src="images/ngc7331_stephan.jpg" style="width: 800px;"><div class="line-block">
<div class="line"><br></div>
</div>
<p>La de mayor tamaño es <strong>NGC7331</strong>, y a su alrededor se pueden ver un grupo de galaxias satélites de ésta. En la esquina inferior derecha se encuentra el <strong>Quinteto de Stephan</strong>.</p>
<p>La idea era realizar fotografías hasta acumular un total de 3 horas aproximadamente, ya que aunque NGC7331 tiene una magnitud aproximada de <span class="math">\(9.48\)</span>, relativamente brillante para una galaxia, las galaxias del Quinteto son mucho más débiles (magnitudes entre <span class="math">\(13\)</span> y <span class="math">\(16\)</span>) y pequeñas, por lo que necesitan mucha más luz para obtener detalles. Sin embargo, una serie de problemas que fueron surgiendo hicieron que sólo pudiera tomar 1 hora en total.</p>
<p>Espero poder dedicarle otra noche para acumular más tomas y conseguir sacar más detalle.</p>
<div class="section" id="equipo">
<h2>Equipo</h2>
<ul class="simple">
<li>Telescopio: Celestron C8 + reductora de focal x0.63.</li>
<li>Montura SkyWatcher EQ6.</li>
<li>Guiado: QHY5-IIM en tubo Lunático (60mm diámetro, 230mm focal)</li>
<li>Cámara: Atik 383L+, refrigerada a <span class="math">\(-20 ^\circ C\)</span>.</li>
<li>
<a class="reference external" href="https://sciencecenter.net/hutech/idas/lps.htm">Filtro de contaminación lumínica IDAS</a>.</li>
<li>RaspberryPi con <a class="reference external" href="https://www.indilib.org/">INDI</a> para control de todo el equipo.</li>
</ul>
</div>
<div class="section" id="datos-de-la-imagen">
<h2>Datos de la imagen</h2>
<ul class="simple">
<li>6 tomas de 10 minutos de exposición (total acumulado: 1h)</li>
<li>Bias: <span class="math">\(30 \times 0.001 \; \text{s}\)</span>
</li>
<li>Dark: <span class="math">\(6 \times 10 \; \text{min}\)</span>
</li>
<li>Flat: <span class="math">\(30 \times 1 \; \text{s}\)</span>, colocando un difusor en el tubo y disparando un flash.</li>
<li>Fecha: 2019/08/03</li>
</ul>
</div>
<div class="section" id="software">
<h2>Software</h2>
<ul class="simple">
<li>Control del telescopio, guiado y captura de imágenes: <a class="reference external" href="https://edu.kde.org/kstars/">KStars</a>.</li>
<li>Preprocesado, alineado, apilado y procesado básico de imágenes: <a class="reference external" href="https://www.siril.org/">Siril</a>.</li>
<li>Post procesado en <a class="reference external" href="https://www.gimp.org/">GIMP</a>.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/m27-nebulosa-de-dumbbell/" class="u-url">M27 - Nebulosa de Dumbbell</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/m27-nebulosa-de-dumbbell/" rel="bookmark">
            <time class="published dt-published" datetime="2019-07-31T20:45:44+02:00" itemprop="datePublished" title="2019-07-31">2019-07-31</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>El pasado fín de semana, aprovechando que daban buena noche, me escapé a León para probar la nueva cámara CCD, una <a class="reference external" href="https://www.atik-cameras.com/product/atik-383l-plus/">Atik 383L+</a>, de 8.3 Mpx y que con el C8 y la reductora de focal x0.63 me da un campo aproximado de <span class="math">\(48' \times 36'\)</span> (<a class="reference external" href="https://es.wikipedia.org/wiki/Minuto_de_arco">minutos de arco</a>), bastante grande para una CCD comparado con los <span class="math">\(62' \times 42'\)</span> que obtenía con la Canon 50D.</p>
<p>Decidí probar con <a class="reference external" href="https://duckduckgo.com/?q=nebulosa+dumbbell&amp;ia=images&amp;iax=images&amp;atb=v136-1">M27</a>, la <a class="reference external" href="https://es.wikipedia.org/wiki/Nebulosa_planetaria">nebulosa planetaria</a> Dumbbell, una "pelota" grande y luminosa que suele salir bien en las fotos.</p>
<p>La cámara es monocromo, para poder usar en el futuro <a class="reference external" href="https://duckduckgo.com/?q=astrophotography+narrow+band&amp;atb=v136-1&amp;iar=images&amp;iax=images&amp;ia=images">filtros de banda estrecha</a> para capturar emisiones de <span class="math">\(\text{H}_{\alpha}\)</span> (hidrógeno) o el <span class="math">\(\text{OIII}\)</span> (oxígeno)</p>
<div class="line-block">
<div class="line"><br></div>
</div>
<img alt="M27, nebulosa de Dumbbell." class="align-center" src="images/m27_190728.jpg" style="width: 800px;"><div class="section" id="equipo">
<h2>Equipo</h2>
<ul class="simple">
<li>Telescopio: Celestron C8 + reductora de focal x0.63.</li>
<li>Montura SkyWatcher EQ6.</li>
<li>Guiado: QHY5-IIM en tubo Lunático (60mm diámetro, 230mm focal)</li>
<li>Cámara: Atik 383L+, refrigerada a <span class="math">\(-20 ^\circ C\)</span>.</li>
<li>
<a class="reference external" href="https://sciencecenter.net/hutech/idas/lps.htm">Filtro de contaminación lumínica IDAS</a>.</li>
<li>RaspberryPi con <a class="reference external" href="https://www.indilib.org/">INDI</a> para control de todo el equipo.</li>
</ul>
</div>
<div class="section" id="datos-de-la-imagen">
<h2>Datos de la imagen</h2>
<ul class="simple">
<li>12 tomas de 10 minutos de exposición (total acumulado: 2h)</li>
<li>Bias: <span class="math">\(30 \times 0.001 \; \text{s}\)</span>
</li>
<li>Dark: <span class="math">\(10 \times 10 \; \text{min}\)</span>
</li>
<li>Flat: <span class="math">\(30 \times 1 \; \text{s}\)</span>, colocando un difusor en el tubo y disparando un flash.</li>
</ul>
</div>
<div class="section" id="software">
<h2>Software</h2>
<ul class="simple">
<li>Control del telescopio, guiado y captura de imágenes: <a class="reference external" href="https://edu.kde.org/kstars/">KStars</a>.</li>
<li>Preprocesado, alineado, apilado y procesado básico de imágenes: <a class="reference external" href="https://www.siril.org/">Siril</a>.</li>
<li>Post procesado en <a class="reference external" href="https://www.gimp.org/">GIMP</a>.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/simulacion-de-circuto-para-lectura-de-tension/" class="u-url">Simulación de circuto para lectura de tensión</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/simulacion-de-circuto-para-lectura-de-tension/" rel="bookmark">
            <time class="published dt-published" datetime="2019-06-11T13:29:55+02:00" itemprop="datePublished" title="2019-06-11">2019-06-11</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Para un proyecto de robótica que estoy comenzando, basado en versiones de los rover marcianos de NASA, necesitaba diseñar un circuito para hacer la lectura de la corriente que circula por un motor controlado mediante un driver <a class="reference external" href="https://www.allegromicro.com/~/media/Files/Datasheets/A4952-3-Datasheet.pdf">Allegro A4953</a>. Este driver tiene un pin LSS en el que se puede conectar una resistencia <span class="math">\(R_S\)</span> para medir la corriente del motor, que se obtiene simplemente dividiendo la tensión <span class="math">\(V_S\)</span> en la resistencia por el valor de la misma:</p>
<div class="math">
\begin{equation*}
I_{motor} = \frac{V_S}{R_S}
\end{equation*}
</div>
<p>Las conexiones del chip se muestran en la hoja de datos:</p>
<img alt="Conexiones del A4953" class="align-center" src="images/a4953_conexiones.png" style="width: 300px;"><p>El esquema del circuito se hizo en <a class="reference external" href="http://www.kicad-pcb.org/">KiCad</a> y se simuló con <a class="reference external" href="http://ngspice.sourceforge.net/">ngspice</a>. La tensión en la resistencia <span class="math">\(R_S\)</span>, <span class="math">\(V_S\)</span>, se simula usando una fuente de tensión (<span class="math">\(V_1\)</span> en el esquema) cuyo valor se hace variar entre los valores máximo y mínimo.</p>
<img alt="Esquema" class="align-center" src="images/a4953_current_sensing.png" style="width: 70%;"><div class="section" id="calculos">
<h2>Cálculos</h2>
<div class="section" id="resistencia-r-s">
<h3>Resistencia <span class="math">\(R_S\)</span>
</h3>
<p>En la hoja de datos del driver se especifica que el valor de la tensión en la <span class="math">\(R_S\)</span> debe ser menor, en valor absoluto, que <span class="math">\(0.5V\)</span>. Para calcular esta resistencia, se da una expresión en función de <span class="math">\(I_{max}\)</span>, la corriente máxima que puede circular por el motor, <span class="math">\(A\)</span>, una ganancia interna que se define con el valor <span class="math">\(10\)</span>, y <span class="math">\(V_{ref}\)</span>, la tensión que se aplique en el pin VREF:</p>
<div class="math">
\begin{equation*}
I_{max} = \frac{V_{ref}}{A R_S}
\end{equation*}
</div>
<p>Para una corriente máxima de <span class="math">\(1.1A\)</span> y <span class="math">\(V_{ref} = 5V\)</span>:</p>
<div class="math">
\begin{equation*}
R_S = \frac{V_{ref}}{A  I_{max}} = \frac{5V}{10 \times 1.1A} = 0.45 \Omega
\end{equation*}
</div>
<p>Eligiendo  <span class="math">\(R_S = 0.4 \Omega\)</span>, la tensión máxima que se tendrá en LSS es, en valor absoluto, <span class="math">\(V_S = 0.4 \Omega \times 1.1A = 0.44V &lt; 0.5V\)</span>, por lo que la tensión en LSS estará comprendida entre <span class="math">\(-0.44V\)</span> y <span class="math">\(+0.44V\)</span>.</p>
</div>
<div class="section" id="adaptacion-de-tensiones">
<h3>Adaptación de tensiones</h3>
<p>Este rango de tensiones será leído mediante el <a class="reference external" href="https://es.wikipedia.org/wiki/Conversor_de_se%C3%B1al_anal%C3%B3gica_a_digital">conversor analógico/digital (ADC)</a> de un <a class="reference external" href="https://store.arduino.cc/arduino-nano">Arduino Nano</a>, que registra tensiones entre <span class="math">\(0\)</span> y <span class="math">\(5V\)</span> con una resolución de 10 bit (1024 cuentas), por lo que es necesario adaptar estas tensiones a valores adecuados para tener una resolución decente en la lectura. Idealmente, se intentaría usar todo el rango <span class="math">\((0V, 5V)\)</span> del ADC, pero conviene dejar márgenes de seguridad para asegurar que no se alcanzan los máximos y para evitar que el amplificador operacional que hará la adaptación trabaje en los extremos (<span class="math">\(0V\)</span> y <span class="math">\(VCC\)</span>), lo que puede producir valores erróneos.</p>
<p>La adaptación de tensiones se realiza usando un <a class="reference external" href="http://www.ti.com/lit/ds/symlink/lm358.pdf">amplificador operacional LM358</a> configurado como <a class="reference external" href="https://es.wikipedia.org/wiki/Amplificador_operacional#Amplificador_no_inversor">amplificador no inversor</a>. En esta configuración, la ganancia es positiva, por lo que el primer obstáculo está en transformar el rango de tensiones en LSS para que todas sean positivas. Para ello se coloca en serie con la tensión <span class="math">\(V_S\)</span> un diodo alimentado desde el pin de <span class="math">\(3.3V\)</span> del Arduino que sumará su tensión de codo, unos <span class="math">\(0.66V\)</span> de promedio, al valor de <span class="math">\(V_S\)</span>, por lo que se pasa a tener un rango de tensiones <span class="math">\((Vd-Vs, Vd+Vs) = (0.23V, 1.09V)\)</span>, todas positivas. Estas tensiones, <span class="math">\(V_M\)</span> en el esquema y en la gráfica, se pasan como entrada a la etapa amplificadora para adaptarlas al rango <span class="math">\((0V, 5V)\)</span> del ADC.</p>
</div>
<div class="section" id="amplificador-operacional">
<h3>Amplificador operacional</h3>
<p>La ganancia del amplificador no inversor viene dada, en este circuito, por</p>
<div class="math">
\begin{equation*}
A_v = 1 + \frac{R_4}{R_2+R_3}
\end{equation*}
</div>
<p>y la tensión en la salida será</p>
<div class="math">
\begin{equation*}
V_{OUT} = A_v   V_M
\end{equation*}
</div>
<p>Según las especificaciones del LM358, en la salida de este operacional se pueden obtener tensiones entre <span class="math">\(0V\)</span> y <span class="math">\(VCC-1.5V\)</span>, por lo que si fijamos un valor máximo aproximado de tensión en el ADC de <span class="math">\(4.5V\)</span> se tiene que VCC debe ser igual a <span class="math">\(6V\)</span>, que es una de las tensiones que se va a usar en la placa definitiva. Ese valor máximo también da un margen de seguridad en la tensión medida en el ADC.</p>
<p>Para obtener <span class="math">\(4.5V\)</span> en la salida cuando se tienen <span class="math">\(1.09V\)</span> enla entrada necesitamos una ganancia de tensión igual a</p>
<div class="math">
\begin{equation*}
\frac{4.5V}{1.09V} = 4.13 = 1 + \frac{R_4}{R_2+R_3}
\end{equation*}
</div>
<p>por lo que la relación <span class="math">\(\frac{R_4}{R_2+R_3}\)</span> tiene que ser menor o igual a <span class="math">\(3.13\)</span> para no sobrepasar los <span class="math">\(4.5V\)</span>.  Seleccionando <span class="math">\(R_2+R_3 = 110 \: k \Omega\)</span> y <span class="math">\(R_4 = 330 \:k \Omega\)</span> se obtiene una relación de <span class="math">\(3\)</span> y una ganancia <span class="math">\(A_v = 4\)</span>.</p>
<p>Con esta ganancia el rango de tensiones en la salida del amplificador será</p>
<div class="math">
\begin{equation*}
V_{OUT} = (A_v \times 0.23, \: Av \times 1.09) = (0.90V, \: 4.35V)
\end{equation*}
</div>
<p>que se corresponden con valores medidos en el ADC de <span class="math">\((184, 890)\)</span>, utilizando un <span class="math">\(69 \%\)</span> del rango del ADC.</p>
</div>
<div class="section" id="simulacion">
<h3>Simulación</h3>
<p>La gráfica siguiente muestra el resultado de la simulación para los parámetros <span class="math">\(V_S\)</span>, <span class="math">\(V_M\)</span> y <span class="math">\(V_{OUT}\)</span> cuando <span class="math">\(V_S\)</span> se hace variar entre <span class="math">\(-0.44V\)</span> y <span class="math">\(+0.44V\)</span>.</p>
<img alt="Plot" class="align-center" src="images/output.jpg" style="width: 50%;"><p>La simulación devuelve los siguientes valores de las tensiones <span class="math">\(V_M\)</span>, tras sumar la tensión de codo del diodo, y <span class="math">\(V_{OUT}\)</span>, a la salida del amplificador, para los casos en que <span class="math">\(V_S\)</span> toma los valores mínimo, <span class="math">\(0\)</span> y máximo:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%">
<col width="30%">
<col width="37%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head"><span class="math">\(V_S\)</span></th>
<th class="head"><span class="math">\(V_M\)</span></th>
<th class="head"><span class="math">\(V_{OUT}\)</span></th>
</tr></thead>
<tbody valign="top">
<tr>
<td><span class="math">\(-0.44\)</span></td>
<td><span class="math">\(0.23\)</span></td>
<td><span class="math">\(0.90\)</span></td>
</tr>
<tr>
<td><span class="math">\(0.00\)</span></td>
<td><span class="math">\(0.66\)</span></td>
<td><span class="math">\(2.63\)</span></td>
</tr>
<tr>
<td><span class="math">\(+0.44\)</span></td>
<td><span class="math">\(1.09\)</span></td>
<td><span class="math">\(4.35\)</span></td>
</tr>
</tbody>
</table>
<p>Se puede ver cómo <span class="math">\(V_M\)</span> toma valores siempre positivos, por lo que no hay problemas en el amplificador. También se ve que la tensión a la salida está en el rango del conversor ACD.</p>
</div>
</div>
<div class="section" id="resolucion-en-corriente">
<h2>Resolución en corriente</h2>
<p>Se puede calcular la resolución de la medida de corriente por el motor, es decir cuánto cambia la corriente por cada cuenta del ADC.</p>
<p>La tensión de salida del amplificador es:</p>
<div class="math">
\begin{equation*}
V_{OUT} = A_v(R_S i_S + V_d)
\end{equation*}
</div>
<p>siendo <span class="math">\(i_S\)</span> la corriente que circula por <span class="math">\(R_S\)</span> (se desprecia la corrientes que circula por el diodo, del orden de <span class="math">\(1 mA\)</span>) y <span class="math">\(V_d\)</span> la tensión de codo en el diodo.</p>
<p>Expresado como cuentas del ADC:</p>
<div class="math">
\begin{equation*}
N = \frac{1024}{5}  V_{OUT}
\end{equation*}
</div>
<p>Si tomamos dos medidas consecutivas del ADC, <span class="math">\(N1\)</span> y <span class="math">\(N2 = N1 + 1\)</span>:</p>
<div class="math">
\begin{equation*}
N2 - N1 = \frac{1024}{5} Av (R_S i_2 + V_d) - \frac{1024}{5} Av (R_S i_1 + V_d)
\end{equation*}
</div>
<p>Operando:</p>
<div class="math">
\begin{equation*}
1 = \frac{1024}{5} Av R_S (i_2 - i_1)
\end{equation*}
</div>
<p>y se tiene:</p>
<div class="math">
\begin{equation*}
i2 - i1 = \Delta i = \frac{5}{1024 \: A_v R_S} = 3.05 \dfrac{mA}{cuenta}
\end{equation*}
</div>
<p>Es decir, se tiene una resolución en la medida de corriente que circula por el motor de unos <span class="math">\(3 \: mA\)</span>.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/turtlebot3-y-ros-melodic-en-ubuntu-1804/" class="u-url">Turtlebot3 y ROS Melodic en Ubuntu 18.04</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/turtlebot3-y-ros-melodic-en-ubuntu-1804/" rel="bookmark">
            <time class="published dt-published" datetime="2019-03-04T17:46:03+01:00" itemprop="datePublished" title="2019-03-04">2019-03-04</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Al empezar a hacer pruebas con el <a href="https://davidvg.github.io/posts/turtlebot3/">Turtlebot3</a> empezaron a aparecer algunos problemas de compatibilidad relacionados con las diferentes versiones de ROS y Ubuntu, que se resumen en:</p>
<ol>
<li>El código del Turtlebot3 está escrito para la versión <a href="https://wiki.ros.org/kinetic">Kinetic</a> de ROS.</li>
<li>Kinetic es compatible con las versiones Wily (15.10) y Xenial (16.04) de Ubuntu.</li>
<li>En mi ordenador tengo instalado Ubuntu Bionic (18.04), versión para la que Kinetic no es compatible.</li>
<li>ROS Melodic, la versión que tiene soporte para Ubuntu 18.04, no tiene soporte completo para Turtlebot3 (algunos de los módulos y funciones necesarios para el Turtlebot3 aún no se han portado a Melodic)</li>
</ol>
<blockquote>
<p><strong>TL;DR</strong>: La versión de ROS que puedo instalar “fácilmente” en mi sistema operativo no da soporte completo al Turtlebot3, y a la vez la versión de ROS que da soporte a Turtlebot3 no es compatible con mi sistema operativo. Incompatibilidad en ambos sentidos.</p>
</blockquote>
<p>Esto me dejaba varias posibles soluciones:</p>
<ol>
<li>Crear una <a href="https://es.wikipedia.org/wiki/M%C3%A1quina_virtual">máquina virtual</a> corriendo Ubuntu 16.04 e instalar ROS Kinetic.</li>
<li>Usar <a href="https://www.docker.com/">Docker</a> para crear un contenedor con Ubuntu 16.04 e instalar ROS Kinetic.</li>
<li>Usar una de las imágenes de <a href="https://docs.docker.com/samples/library/ros/">Docker con ROS preinstalado</a> con la versión Kinetic.</li>
<li>Usar Ubuntu 18.04 y ROS Melodic e ir solucionando los problemas a medida que surjan.</li>
</ol>
<p>La máquina virtual la descarté de mano, por ser más práctico usar los contenedores de Docker. Sin embargo, como en los grupos de usuarios de ROS se habla de que todo el código del Turtlebot3 se está portando poco a poco a Melodic, opté por probar con la última opción e ir resolviendo los problemas a medida que se iban <del>amontonando</del> produciendo.</p>
<p><img alt="Si eso más terde me pongo..." src="images/memes/ITcrowd-put-this-with-rest-of-fire.jpg" width="40%"></p>
<h3>Instalación de módulos no portados a Melodic</h3>
<p>Instalar los módulos que <a href="https://index.ros.org/packages/#melodic">no estan aún portados</a> resulta más fácil de lo podría pensarse. Aunque no estén disponibles para ROS Melodic, los repositorios de cada uno de ellos están disponibles en GitHub; muchos ya tienen una rama lista para ser integrada en futuras actualizaciones de Melodic, y el resto pueden descargarse y compilarse con las características del sistema que se emplee.
Los módulos necesarios para hacer funcionar el Turtlebot3 y que no están disponibles en Melodic pero pueden instalarse desde GitHub son:</p>
<ul>
<li><code>openslam_gmapping</code></li>
<li>
<code>slam_gmapping</code>: módulo de creación de mapas mediante <em>SLAM</em> (<em>Simultaneous Localization and Mapping</em>)</li>
<li>
<code>hector_slam</code>, <code>slam_karto</code>: otros métodos de cartografiado utilizados por el Turtlebot.</li>
<li>
<code>frontier_exploration</code>: módulo de exploración de mapas.</li>
<li>
<code>teleop_twist_joy</code>: utilización de <em>joystick</em> para controlar el robot.</li>
</ul>
<p>Estos paquetes se pueden descargar o clonar en el directorio <code>src</code> del proyecto y compilar con <code>catkin_make</code> o <code>catkin build</code>. El resto de paquetes disponibles para Melodic se instalan mediante el gestor de software de Ubuntu, o mediante <code>apt-get</code> o similar.</p>
<h3>Mapas globales y locales</h3>
<p>Un error que aparece por cambios en Melodic respecto a Kinetic se produce por diferencia del criterio usado a la hora de definir la ruta a los mapas en el paquete de <a href="http://emanual.robotis.com/docs/en/platform/turtlebot3/navigation/">navegación</a> del Turtlebot3.</p>
<p>[Reproducción del error]
[Explicación del problema]</p>
<p>Para solucionarlo hay que editar dos archivos dentro del directorio <code>src/turtlebot3_navigation/params</code>, en los que se definen algunos parámetros necesarios para la navegación.</p>
<p>Uno de los archivos que hay que modificar en dicho directorio es <code>global_cost_map_params.yaml</code>, eliminando las barras en<code>/map</code> y <code>/base_footprint</code>:</p>
<pre class="code literal-block"><span></span><span class="n">global_costmap</span><span class="o">:</span>
  <span class="n">global_frame</span><span class="o">:</span> <span class="o">/</span><span class="n">map</span>
  <span class="n">robot_base_frame</span><span class="o">:</span> <span class="o">/</span><span class="n">base_footprint</span>
</pre>


<p>para que queden del siguiente modo (nótese la ausencia de barras delante de los parámetros):</p>
<pre class="code literal-block"><span></span><span class="n">global_costmap</span><span class="o">:</span>
  <span class="n">global_frame</span><span class="o">:</span> <span class="n">map</span>
  <span class="n">robot_base_frame</span><span class="o">:</span> <span class="n">base_footprint</span>
</pre>


<p>El segundo archivo a modificar es <code>local_costmap_params.yaml</code>, eliminando las barras para que queden del siguiente modo:</p>
<pre class="code literal-block"><span></span><span class="n">local_costmap</span><span class="o">:</span>
  <span class="n">global_frame</span><span class="o">:</span> <span class="n">odom</span>
  <span class="n">robot_base_frame</span><span class="o">:</span> <span class="n">base_footprint</span>
</pre>


<p>Con esto los parámetros <code>map</code>, <code>base_footprint</code> (tanto para los parámetros globales como locales) y <code>odom</code> se definen como relativos al propio paquete, y no como absolutos como ocurre con el caso de colocar la barra (<code>/</code>) delante.</p>
<h3>Bola extra: problemas de visualización en <code>rviz</code>
</h3>
<p>Otro problema derivado de la pantalla de alta resolución de mi portátil, un Dell XPS 13, son los <a href="https://wiki.ros.org/rvi://github.com/ros-visualization/rviz/issues/1069">problemas de visualización en <code>rviz</code></a>, el visualizador que usa ROS; además, al intentar redimensionar la ventana o al colocar otra ventana encima, no se actualiza el contenido, por lo que no es utilizable.</p>
<p><img src="images/rviz-problema-visualizacion.png" alt="Problemas de visualización en rviz" width="60%"></p>
<p>Para <a href="https://github.com/ros-visualization/rviz/issues/1203">solucionarlo</a>, basta con exportar (para dejarlas en blanco) dos variables de entorno:</p>
<pre class="code literal-block"><span></span>export QT_AUTO_SCREEN_SCALE_FACTOR=
export QT_SCREEN_SCALE_FACTORS=
</pre>


<p>Con estos pasos, el entorno está plenamente funcional.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/turtlebot3/" class="u-url">Turtlebot3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/turtlebot3/" rel="bookmark">
            <time class="published dt-published" datetime="2019-01-24T17:00:00+01:00" itemprop="datePublished" title="2019-01-24">2019-01-24</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Este año los Reyes Magos se han puesto espléndidos y me han traído un <a href="http://www.robotis.us/turtlebot-3/">Turtlebot3</a>, el modelo Burger para ser más exactos. Bueno, en realidad no han sido los Reyes, sino que me lo he auto-regalado.</p>
<!-- <img style="float: center;" src="/home/david/git/blog/output/images/turtlebot3.jpg" width=480 > -->

<p><img alt="turtlebot3" src="images/turtlebot3.jpg"></p>
<p>Aunque también sirve para pasar un buen rato jugando con él, en realidad es una plataforma de desarrollo de robótica, ya que es un robot modular y totalmente personalizable. Es un robot de dos ruedas y una bola que actúa como rueda castor o giratoria. Se organiza en 4 niveles mediante plataformas:</p>
<ul>
<li>Nivel 1: aloja los motores y la batería.</li>
<li>Nivel 2: en él se encuentra la placa <a href="http://wiki.ros.org/opencr">OpenCR</a>, basada en <a href="https://www.arduino.cc/">Arduino</a>, y que incluye el hardware necesario para implementar el Turtlebot3: sensores, drivers para motores, interfaces de comunicaciones, etc.</li>
<li>Nivel 3: en él se coloca la <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b/">Raspberry Pi 3</a> en la que se ejecuta <a href="http://www.ros.org/">ROS</a>, el sistema operativo del robot. También tiene espacio suficiente para añadir más sensores o componentes.</li>
<li>Nivel 4: es el nivel superior y sobre el que se coloca el <a href="https://en.wikipedia.org/wiki/Lidar">LIDAR</a>, que se emplea para medir distancias y que a grandes rasgos es similar al <a href="https://es.wikipedia.org/wiki/Radar">RADAR</a> pero usando la luz de un láser.</li>
</ul>
<p>Como cada nivel es idéntico a los demás, se pueden añadir más niveles si se necesitan.</p>
<p>El proyecto es <a href="https://es.wikipedia.org/wiki/C%C3%B3digo_abierto">código</a> abierto, u open source, tanto el <a href="https://es.wikipedia.org/wiki/Hardware_libre">hardware</a> como el <a href="https://es.wikipedia.org/wiki/Software_libre">software</a>, por lo que es posible modificarlo, adaptarlo y configurarlo a medida. Todas las partes que forman los niveles, los mecanismos de sujeción, etc. se pueden imprimir en una impresora 3D usando los diseños que están disponibles en la web.</p>
<p>De momento estoy haciendo pruebas, ya que el Turtlebot3 se desarrolló para la versión de ROS Kinetic Kame, que a su vez es compatible con <a href="https://www.ubuntu.com/">Ubuntu</a> 16.04, mientras que yo tengo instalado Ubuntu 18.04, para la que Kinetic no es compatible; sí lo es la última versión disponible de ROS, Melodic Morenia, a la que se está portando el código de Turtlebot3.</p>
<p>Hasta ahora he conseguido que funcionen sin demasiados problemas los modos básicos de teleoperación del robot, mediante teclado y joystick, y las funciones básicas de <a href="https://es.wikipedia.org/wiki/Localizaci%C3%B3n_y_modelado_simult%C3%A1neos">SLAM</a> y cartografiado, así como la navegación autónoma básica usando el mapa creado.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jupiter-180513/" class="u-url">Júpiter</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/jupiter-180513/" rel="bookmark">
            <time class="published dt-published" datetime="2018-05-31T18:18:43+02:00" itemprop="datePublished" title="2018-05-31">2018-05-31</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Esta temporada Júpiter se encuentra en <a href="https://es.wikipedia.org/wiki/Oposici%C3%B3n_(astronom%C3%ADa)">oposición</a>, lo que viene a significar que desde la Tierra lo vemos en el punto opuesto al Sol.</p>
<p>En la fotografía se pueden apreciar, a la izquierda, tres puntos que se corresponden con tres de las lunas de Júpiter; de izquierda a derecha, son Ganimedes, Calisto (un punto más débil que los otros) e Ío, tres de las cuatro <a href="https://es.wikipedia.org/wiki/Sat%C3%A9lite_galileano">lunas galileanas</a>.</p>
<p><img alt="Jupiter y lunas" src="images/jupiter.jpeg"></p>
<p>Como <em>bonus</em>, se puede también apreciar la cuarta luna galileana, Europa, como una pequeña zona circular algo más brillante sobre el disco de Júpiter, así como la sombra que proyecta dicha luna sobre el planeta. En el recorte ampliado de abajo se puede ver algo mejor.</p>
<p><img alt="Jupiter, Europa y su sombra" src="images/jupiter_disc.jpeg"></p>
<h3>Datos de la toma</h3>
<p>La cámara es una QHY5-II-M en un Celestron C8, sobre montura Skywatcher EQ6.</p>
<p>La imagen se obtuvo el día 13 de mayo de 2018, a las 4:08 de la madrugada, desde León, mediante apilado de un video de 30 segundos, compuesto por 386 frames, capturado usando <a href="https://www.openastroproject.org/oacapture/">oaCapture</a> en Ubuntu.</p>
<p>El apilado y procesado se realizó íntegramente usando <a href="https://free-astro.org/index.php/Siril">Siril 0.9.9</a> en Ubuntu.</p>
<p>El recorte y añadido de texto se hizo usando <a href="https://www.gimp.org/">GIMP</a> en Ubuntu.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/beaglebone-black-alternativa-a-la-raspberry-pi/" class="u-url">BeagleBone Black, una alternativa a la Raspberry Pi</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/beaglebone-black-alternativa-a-la-raspberry-pi/" rel="bookmark">
            <time class="published dt-published" datetime="2017-09-10T12:30:00+02:00" itemprop="datePublished" title="2017-09-10">2017-09-10</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<h3>Introducción</h3>
<p>La BeagleBone Black es una computadora <a href="https://es.wikipedia.org/wiki/Hardware_Libre">open hardware</a> similar a la más conocida <a href="posts/beaglebone-black-alternativa-a-la-raspberry-pi/www.raspberrypi.org">Raspberry Pi</a>. Es la versión de bajo costo de la familia <a href="https://beagleboard.org">BeagleBoard</a>, fabricada por la mítica <a href="https:/https:///www.ti.com">Texas Instruments</a>. Entre sus características más interesantes están:</p>
<ul>
<li>Procesador Sitara AM3358 a 1 GHz.</li>
<li>512 MB de RAM DDR3L a 800 MHz.</li>
<li>Memoria interna eMMC de 4 GB.</li>
<li>3 canales <a href="https://es.wikipedia.org/wiki/Modulaci%C3%B3n_por_ancho_de_pulsos">PWM</a>.</li>
<li>7 entradas de <a href="https://es.wikipedia.org/wiki/Conversi%C3%B3n_anal%C3%B3gica-digital">Conversor Analógico/Digital (ADC)</a> de 10 bit.</li>
<li>3 canales <a href="https://es.wikipedia.org/wiki/I%C2%B2C">I2C</a>.</li>
<li>2 canales <a href="https://es.wikipedia.org/wiki/Serial_Peripheral_Interface">SPI</a>.</li>
<li>5 puertos serie <a href="https://es.wikipedia.org/wiki/Universal_Asynchronous_Receiver-Transmitter">UART</a> (uno de ellos sólo con función de trasferir datos, no de recibir)</li>
<li>3 módulos descodificadores de <a href="http://www.ni.com/tutorial/7109/es/">encoder de cuadratura</a> (enhanced quadrature encoder pulse, eQEP), aunque para usarlos todos es necesario deshabilitar otros módulos que causan interferencia en los pines.</li>
<li>2 <a href="https://es.wikipedia.org/wiki/Sistma_de_tiempo_real">Unidades en Tiempo Real Programables (PRU)</a>.</li>
<li>Conexión WiFi y Bluetooth integradas en la versión [Wireless.</li>
</ul>
<p>A nivel hardware existen más elementos para algunos de los dispositivos anteriores, aunque sólo parte de ellos están disponibles debido a interferencia entre pines y multiplexado; por ejemplo, el procesador tiene 6 canales UART, de los que sólo están disponibles desde los pines 5 de ellos.</p>
<p>Este post resume los pasos que han sido necesarios para poner en funcionamiento la Beaglebone Black, tanto en su versión original (revisión C.1) como la versión Wireless. A partir de ahora, me referiré a la BeagleBone Black como BBB y a su versión Wireless como BBBW.</p>
<p>Todos los pasos se harán para un sistema GNU/Linux Ubuntu 16.04, preferentemente usando la línea de comandos.</p>
<p class="more"><a href="posts/beaglebone-black-alternativa-a-la-raspberry-pi/">Leer más…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nikola-anadir-una-pagina-de-wikis/" class="u-url">Nikola - Añadir una página de wikis</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/nikola-anadir-una-pagina-de-wikis/" rel="bookmark">
            <time class="published dt-published" datetime="2017-02-17T17:17:50+01:00" itemprop="datePublished" title="2017-02-17">2017-02-17</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Uno de los objetivos de crear la web era disponer de una página de wikis, en la que poder ir anotando todas aquellas cosas que, por trabajo, hobby, ocio, o cualquier otro motivo, voy aprendiendo y que resulta práctico, si no recordar, tener archivado en algún lugar a mano.</p>
<p>Estas notas serían, por ejemplo, flujos de aplicación de algoritmos de <a href="https://es.wikipedia.org/wiki/Aprendizaje_autom%C3%A1tico">Machine Learning</a>, los principales usos de las <a href="https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular#Descripci.C3.B3n_de_las_expresiones_regulares">expresiones regulares</a>, pequeños fragmentos de código, o cualquier otra cosa.</p>
<p>El fin es tener una portada, accesible desde la barra de navegación, que enlazará a otras páginas, cada una de las cuales contendrá información sobre un tema, aplicación, etc.</p>
<p class="more"><a href="posts/nikola-anadir-una-pagina-de-wikis/">Leer más…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nikola-github-pages-instalacion/" class="u-url">Nikola + GitHub Pages - Instalación</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                David Vázquez
            </span></p>
            <p class="dateline">
            <a href="posts/nikola-github-pages-instalacion/" rel="bookmark">
            <time class="published dt-published" datetime="2017-01-27T12:00:00+01:00" itemprop="datePublished" title="2017-01-27">2017-01-27</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Después de mucho pensar, de mucho mirar, y de mucho probar, al fin conseguí empezar a montar el blog. Partía con algunos requisitos:</p>
<ul>
<li>Alojamiento gratuito.</li>
<li>Escritura de posts en Markdown (opción futurible: ReStructuredText)</li>
<li>Posibilidad de publicar posts con expresiones matemáticas.</li>
<li>Posibilidad de publicar notebooks de <a href="https://jupyter.org/">iPython/Jupyter</a>.</li>
<li>Facilidad de uso.</li>
</ul>
<p>La opción que más me ha gustado es la combinación de <a href="https://getnikola.com/">Nikola</a> como sistema de blogging y <a href="https://pages.github.com/">GitHub Pages</a> para el alojamiento.</p>
<p>Nikola está escrito en Python y permite crear posts desde archivos Markdown, ReStructuredText o incluso notebooks de iPython. Se integra perfectamente con <a href="https://www.mathjax.org/">Mathjax</a> para generar expresiones matemáticas.</p>
<p class="more"><a href="posts/nikola-github-pages-instalacion/">Leer más…</a></p>
</div>
    </div>
    </article>
</div>





        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:david.vazquezgijon@gmail.com">David Vázquez</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("es");
    fancydates(0, "YYYY-MM-DD");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
